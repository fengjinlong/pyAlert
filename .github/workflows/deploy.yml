name: 自动部署到服务器

on:
  push:
    branches:
      - main # 当推送到 main 分支时触发

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 检出代码
        uses: actions/checkout@v3

      - name: 部署文件到服务器
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SERVER_HOST || '117.72.63.11' }}
          username: ${{ secrets.SERVER_USERNAME || 'root' }}
          password: ${{ secrets.SERVER_PASSWORD || 'Web198743@' }}
          port: ${{ secrets.SERVER_PORT || 22 }}
          source: "."
          target: "/root/pyAlert"
          strip_components: 0
          exclude: |
            .git
            .github
            __pycache__
            *.pyc
            .DS_Store
            *.md

      - name: 部署完成通知
        run: |
          echo "✅ 代码已成功部署到服务器 ${{ secrets.SERVER_HOST || '117.72.63.11' }}:/root/pyAlert"
